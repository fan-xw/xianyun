<template>
    <section class="contianer">
        <el-row  type="flex" justify="space-between">

            <!-- 顶部过滤列表 -->
            <div class="flights-content">
                <!-- 过滤条件 -->
                <div>
                    过滤条件
                </div>
                
                <!-- 航班头部布局 -->
                <FlightsListHead />
                
                
                <!-- 航班信息 -->
                <div class="list" v-if="dataList.length > 0">
                  <FlightsItem v-for="flight in dataList" :key="flight.id" :data="flight"/>
                </div>
                <div  plain v-else>
                  <!-- 暂时没有数据 -->
                </div>

                <!-- 分页组件 -->
                <!-- 
                  🌾🌾🌾
                  current-change: currentPage改变时会触发--当前页
                  size-change: pageSize改变时会触发--每页条数
                  page-size: 每页显示条目个数，支持 .sync 修饰符	number
                  page-sizes: 每页显示个数选择器的选项设置	number[]		例子:[10, 20, 30, 40, 50, 100]
                 -->
                <el-pagination
                  layout="total, sizes, prev, pager, next, jumper"
                  :page-size="pageSize"
                  :page-sizes="[2,5,10,20,50,100]"
                  :total="flightsDate.total"
                  @current-change="currentChange"
                  @size-change="sizeChange">
                </el-pagination>
            </div>

            <!-- 侧边栏 -->
            <div class="aside">
                <!-- 侧边栏组件 -->
                侧边栏
            </div>


        </el-row>
    </section>
</template>

<script>
import { airsList } from '@/apis/air.js'
// 👌1.引入飞机列表页头部组件
import FlightsListHead from '@/components/air/FlightsListHead'
// 😋1.引入机票列表页组件
import FlightsItem from '@/components/air/FlightsItem'
// 引入Notification 通知
import { Notification } from 'element-ui';
export default {
  data() {
    return {
      flightsDate:{},
      // 当前页码
      pageIndex:1,
      // 每页数据
      pageSize:2,
      // 自己切割出来的应该显示的机票数据
      dataList:[]
    }
  },

  components:{
    // 👌2.注册飞机列表页头部组件
     FlightsListHead,
    // 😋2.注册机票列表页组件
    FlightsItem
  },

  async created() {
    const res = await airsList(this.$route.query)
    console.log(res.data);
    this.flightsDate = res.data
    
    // 空数据状态下的提示  
    this.$notify({
      title: '所选城市',
      message: '暂时没有这两个城市之间的航班',
      position: 'top-left',
      type: 'warning',
      duration:3000
    });
    

    /*
    👍👍👍分页分析:机票数据存在 this.flightDate.flights里面。
            假如当前是第三页！每页10条，那么.splice()的时候就是(20,30) [可以取到左边的参数，但取不到右边的参数(不包括在内)]，
            就可以拿到第20条到第30条之间的数据，
            begin = (3-1) * 10 = 20
            end = 20 + 10 = 30
            .slice(begin,end)
    */ 
    // const begin = (this.pageIndex - 1) * this.pageSize
    // const end = begin + this.pageSize
    // this.dataList = this.flightsDate.flights.slice(begin,end);

    /*
    🌱🌱🌱另外一种思考方式：当前翻到第几页，结束就应该是当前页码乘以长度
       假如每页十条：第一页以10结束，第二页以20结束，第三页以30结束，
       开始的参数 = 结束参数 - 一个长度
    */
    // const end = this.pageIndex * this.pageSize
    // const begin = end - this.pageSize
    // this.dataList = this.flightsDate.flights.slice(begin,end);
    
    // 页面一进来就开始切割第一次数据并进行渲染  调用 
    this.dataList = this.getDataList()
  },

  methods:{
    // currentPage 改变时会触发
    currentChange (newIndex) {
       this.pageIndex = newIndex;
       this.dataList = this.getDataList()
    },

    sizeChange (newSize) {
      this.pageSize = newSize
      this.dataList = this.getDataList()
    },

    // 封装
    getDataList() {
      const end = this.pageIndex * this.pageSize;
      const begin = end - this.pageSize;

      return this.flightsDate.flights.slice(begin,end);
    }
    
  }
}
</script>

<style scoped lang="less">
    .contianer{
        width:1000px;
        margin:20px auto;
    }

    .flights-content{
        width:745px;
        font-size:14px;
    }

    .aside{
        width:240px;
    } 
</style>